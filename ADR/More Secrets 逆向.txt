Q:
Marquillo_MoreSecrets_Main
你分析一下“J:\Sims Mods\SimsToolkit\output”文件夹下的package文件，这些是如何把游戏的秘密机制和其他的丑闻机制关联起来的

A:
我确认到有两个包：Marquillo_MoreSecrets_Main.package 和 Marquillo_MoreSecrets_Strings.package。下一步我会用仓库里的解析逻辑读取它们的资源清单，再看具体调谐和文本键值。

我在看模块里的 DBPF 解析函数，确认是否能直接拿到包内资源和实例 ID。拿到这个后，我会提取与“secret/scandal/rumor”等关键词相关的调谐命名和字符串证据。

我会先做一轮“可读字符串提取”，快速抓出包里直接出现的关键词（secret/scandal/rumor/expose 等）。这通常能先看出调谐链路，再决定要不要深挖二进制资源。

直接字符串几乎提不出来，说明资源多数是压缩/二进制调谐。我现在改为读取 DBPF 索引，先把资源类型分布和关键资源 ID 列出来，再反推它改动的是哪些系统。

我已经拿到资源类型分布：Main 里有多类调谐资源，Strings 全是 STBL。接下来我会在仓库源码里反查这些 Type ID 的名称映射，避免凭经验猜。

我在反查类型常量表，直接把这些十六进制 ID 对应到官方资源名（而不是猜测）。随后我会按“主包调谐 + 字符串包文本”给你一个机制链路图。

我已确认 0x6017e896 是 BUFF、0x00b2d882 是 DDS。现在我会逐条检查资源头部和压缩状态，看看哪些条目可直接还原出调谐 XML（这是判断“秘密→丑闻联动”最关键的一步）。

关键点确认了：所有资源都是 zlib 压缩（开头 78 DA）。我现在直接解压每条资源，提取可读 XML/文本和关键词，能比较准确地还原它把秘密机制接到哪些系统上。

已确认可以解压并读到 XML（比如 SimSecret snippet）。我会把 Main 包里所有可读调谐批量导出成文本，再用关键词和引用关系做机制链路分析。

已成功导出 43 个可读 XML。下一步我会统计这些 XML 的调谐类别（如 SimSecret、Buff、LootAction 等）并检索“丑闻/秘密/名誉/关系”关键词，形成证据链。

我已经拿到完整调谐名了，链路很清晰。现在我在读关键 XML（SimSecret、LootActions、SocialMixerInteraction、TuningInjector）里具体字段引用，确认它们是通过哪些 loots/buffs/tests 互相挂接的。

我先对 18 个 LootActions 做结构化摘要：每个条目的“它引用了哪些 Secret/Buff/Broadcaster/Commodity/其他 Loot”。这样可以快速看出关联链，不用逐个手读全文件。

我还在补一层细节：Mock/Shun 互动具体是如何被“秘密已公开”条件门控的，以及它们触发什么后续效果（关系变化、情绪等）。这能把“秘密系统”到“丑闻社交后果”的最后一段链路补齐。

我在整理成“可核验”的结论，会附关键文件和行号。现在先抓这些关键节点的精确行位：注入点、创建秘密、见证转已发现、公开后社交门控、计时器/负面 Buff、以及一个疑似配置错误。


核心结论：`Marquillo_MoreSecrets_Main.package` 是一个“用调谐把自定义秘密接入原版丑闻系统”的桥接包；`Marquillo_MoreSecrets_Strings.package` 只提供文本，不改逻辑。

主要关联链路如下：

1. 入口注入（把“打架/黑函/说坏话”等行为接到秘密系统）
- 通过 `TuningInjector` 注入到现有互动和 loot。  
`output/_moresecrets_extract/0x7df2169c_0x00000000_0xfbc55553951acd10.xml:4`
- 给打架互动注入“创建秘密 + 见证广播”。  
`output/_moresecrets_extract/0x7df2169c_0x00000000_0xfbc55553951acd10.xml:51`  
`output/_moresecrets_extract/0x7df2169c_0x00000000_0xfbc55553951acd10.xml:62`
- 把 `Mock/Shun Scandalized Sim` 注入到 mean socials 列表。  
`output/_moresecrets_extract/0x7df2169c_0x00000000_0xfbc55553951acd10.xml:610`  
`output/_moresecrets_extract/0x7df2169c_0x00000000_0xfbc55553951acd10.xml:612`  
`output/_moresecrets_extract/0x7df2169c_0x00000000_0xfbc55553951acd10.xml:613`
- 把自定义逻辑挂到原版丑闻 loot（发现、揭露、打架失败）。  
`output/_moresecrets_extract/0x7df2169c_0x00000000_0xfbc55553951acd10.xml:619`  
`output/_moresecrets_extract/0x7df2169c_0x00000000_0xfbc55553951acd10.xml:627`  
`output/_moresecrets_extract/0x7df2169c_0x00000000_0xfbc55553951acd10.xml:635`

2. 创建秘密（Secret）
- 典型创建动作用 `create_scandal_secret`，直接创建“Extortionist”等秘密。  
`output/_moresecrets_extract/0x0c772e27_0x0000008d_0x8fc094ebfaea11c3.xml:5`  
`output/_moresecrets_extract/0x0c772e27_0x0000008d_0x8fc094ebfaea11c3.xml:7`
- 限制条件：非 `Clandestine` 地段、年龄 Teen+，并对非 `Carefree/Shameless` 加紧张 buff。  
`output/_moresecrets_extract/0x0c772e27_0x0000008d_0x8fc094ebfaea11c3.xml:23`  
`output/_moresecrets_extract/0x0c772e27_0x0000008d_0x8fc094ebfaea11c3.xml:24`  
`output/_moresecrets_extract/0x0c772e27_0x0000008d_0x8fc094ebfaea11c3.xml:43`

3. 见证与传播（把“秘密”转成“丑闻知道状态”）
- 广播器在附近 Sims 中触发 witness loot（半径 7）。  
`output/_moresecrets_extract/0xdebafb73_0x0000008d_0xfd93edc9bed09bca.xml:71`  
`output/_moresecrets_extract/0xdebafb73_0x0000008d_0xfd93edc9bed09bca.xml:83`
- witness loot 把秘密关系状态改为 `DISCOVERED`，并附加内疚情绪/气泡反应。  
`output/_moresecrets_extract/0x0c772e27_0x0000008d_0xa7cd4d80c9706625.xml:5`  
`output/_moresecrets_extract/0x0c772e27_0x0000008d_0xa7cd4d80c9706625.xml:7`  
`output/_moresecrets_extract/0x0c772e27_0x0000008d_0xa7cd4d80c9706625.xml:20`  
`output/_moresecrets_extract/0x0c772e27_0x0000008d_0xa7cd4d80c9706625.xml:26`
- 还补了一个“揭露后关系状态更新”loot，把 `REVEALED` 关系同步为 `DISCOVERED`。  
`output/_moresecrets_extract/0x0c772e27_0x00000000_0x82c656e20d31bd89.xml:5`  
`output/_moresecrets_extract/0x0c772e27_0x00000000_0x82c656e20d31bd89.xml:7`

4. 丑闻后果（接入原版名誉/职业/关系体系）
- 每个 SimSecret 都定义 `scandal_effects`，绑定 `scandal_commodity` 计时器和 buff。  
`output/_moresecrets_extract/0x7df2169c_0x0000008d_0x00000000964278c6.xml:23`  
`output/_moresecrets_extract/0x7df2169c_0x0000008d_0x00000000964278c6.xml:42`  
`output/_moresecrets_extract/0x7df2169c_0x0000008d_0x00000000964278c6.xml:44`
- 计时器 commodity 负责衰减，状态绑到 ongoing scandal buff。  
`output/_moresecrets_extract/0x339bc5bd_0x00000000_0xe1fdfb5b0c7f0a01.xml:18`  
`output/_moresecrets_extract/0x339bc5bd_0x00000000_0xe1fdfb5b0c7f0a01.xml:29`
- 对应 buff 再打到 Fame/Reputation/JobPerformance，且 Extortionist 会附加交互失败 buff。  
`output/_moresecrets_extract/0x6017e896_0x00000000_0xe99bf1119857ebc9.xml:3`  
`output/_moresecrets_extract/0x6017e896_0x00000000_0xe99bf1119857ebc9.xml:5`  
`output/_moresecrets_extract/0x6017e896_0x00000000_0xe99bf1119857ebc9.xml:6`  
`output/_moresecrets_extract/0x6017e896_0x00000000_0xe99bf1119857ebc9.xml:25`
- “背后说坏话”分支还直接对友情做 `-10`。  
`output/_moresecrets_extract/0x0c772e27_0x00000000_0x9ada5d1bb0b7dbaa.xml:6`  
`output/_moresecrets_extract/0x0c772e27_0x00000000_0xfad8630f630028a4.xml:6`

5. 与“黑函/丑闻社交”的关联
- 有单独黑函互动列表（Career/Dynasty/Simoleons 等）。  
`output/_moresecrets_extract/0x7df2169c_0x00000000_0xd2c684653a45821c.xml:1`  
`output/_moresecrets_extract/0x7df2169c_0x00000000_0xd2c684653a45821c.xml:3`
- `Mock/Shun` 社交通过 TestSet 要求目标已有“已揭露”的这 4 个秘密之一。  
`output/_moresecrets_extract/0x7df2169c_0x0000008d_0xa5ae2cebbd72f837.xml:11`  
`output/_moresecrets_extract/0x7df2169c_0x0000008d_0xa5ae2cebbd72f837.xml:14`  
`output/_moresecrets_extract/0xe882d22f_0x0000008d_0xaca75ac62e678704.xml:2456`  
`output/_moresecrets_extract/0xe882d22f_0x0000008d_0x9327f88e466a6e96.xml:2446`
- 并用短期关系 bit 防重复连发（mock/shun 各自 bit）。  
`output/_moresecrets_extract/0xe882d22f_0x0000008d_0xaca75ac62e678704.xml:2028`  
`output/_moresecrets_extract/0xe882d22f_0x0000008d_0x9327f88e466a6e96.xml:1957`

6. `Strings` 包作用
- `Marquillo_MoreSecrets_Strings.package` 全是 `STBL`（18 条），用于显示名/描述/提示文本，本身不承载逻辑。

补充发现（疑似配置问题）：
- 在随机发现 loot 里，“FoughtExtortionistAndLost”分支的 `secret_type` 写成了一个 Loot ID `16703874997144024878`，不是对应的 SimSecret ID `579037892`，可能导致该分支的“已存在秘密去重测试”失效。  
`output/_moresecrets_extract/0x0c772e27_0x00000000_0xf12b4d47b5e6c6eb.xml:117`